<!DOCTYPE html><html class="no-js"><head><title>The Algorithmic Sketchbook</title><link rel="stylesheet" href="assets/main.css">
<script type="text/javascript" language="javascript" src="codemirror/lib/codemirror.js"></script><script type="text/javascript" language="javascript" src="codemirror/addon/search/searchcursor.js"></script><script type="text/javascript" language="javascript" src="codemirror/addon/search/search.js"></script><script type="text/javascript" language="javascript" src="codemirror/addon/dialog/dialog.js"></script><script type="text/javascript" language="javascript" src="codemirror/addon/edit/matchbrackets.js"></script><script type="text/javascript" language="javascript" src="codemirror/addon/edit/closebrackets.js"></script><script type="text/javascript" language="javascript" src="codemirror/addon/comment/comment.js"></script><script type="text/javascript" language="javascript" src="codemirror/addon/wrap/hardwrap.js"></script><script type="text/javascript" language="javascript" src="codemirror/addon/fold/foldcode.js"></script><script type="text/javascript" language="javascript" src="codemirror/addon/fold/brace-fold.js"></script><script type="text/javascript" language="javascript" src="codemirror/mode/javascript/javascript.js"></script><script type="text/javascript" language="javascript" src="codemirror/keymap/sublime.js"></script><script type="text/javascript" language="javascript" src="js/jquery-2.1.1.min.js"></script><script language="javascript" type="text/javascript" src="libraries/p5.js"></script><script language="javascript" type="text/javascript" src="libraries/p5.dom.js"></script></head><body><h1>progress-stream</h1><p>Read the progress of a stream. Supports speed and eta.</p>
<p>Gets the lengths of the stream automatically if you&#39;re using the request or http module. You can also pass the length on initiation. Progress-stream will also check to see if the stream already have a length property.</p>
<pre><code>npm install progress-stream
</code></pre><h2>Usage</h2><p>This example copies a large file, and prints out the percentage, speed and remaining every 100ms.</p>
<pre><code class="language-js">var progress = require(&#39;progress-stream&#39;);
var fs = require(&#39;fs&#39;);

var stat = fs.statSync(filename);
var str = progress({
    length: stat.size,
    time: 100
});

str.on(&#39;progress&#39;, function(progress) {
    console.log(progress);

    /*
    {
        percentage: 9.05,
        transferred: 949624,
        length: 10485760,
        remaining: 9536136,
        eta: 42,
        runtime: 3,
        delta: 295396,
        speed: 949624
    }
    */
});

fs.createReadStream(filename)
    .pipe(str)
    .pipe(fs.createWriteStream(output));
</code></pre>
<h2>Methods</h2><h3>progress([options], [onprogress])</h3><p>You can instantiate in two ways:</p>
<pre><code class="language-js">var str = progress({time:100});
str.on(&#39;progress&#39;, function(progress) { ... });
</code></pre>
<p>or inline the progress listener</p>
<pre><code class="language-js">var str = progress({time:100}, function(progress) { ... });
</code></pre>
<h2>Properties</h2><h3>.progress</h3><p>You can get the progress from the progress property.</p>
<pre><code class="language-js">var str = progress({time:100});

console.log(str.progress);

/*
{
    percentage: 9.05,
    transferred: 949624,
    length: 10485760,
    remaining: 9536136,
    eta: 10,
    runtime: 0,
    delta: 295396,
    speed: 949624
}
*/
</code></pre>
<h2>Events</h2><h3>on(&#39;progress&#39;, function(progress) { ... })</h3><pre><code class="language-js">var str = progress({time:100});
str.on(&#39;progress&#39;, function(progress) { ... });
</code></pre>
<h2>Options</h2><h3>time(integer)</h3><p>Sets how often progress events is emitted. If omitted then defaults to emit every time a chunk is received.</p>
<h3>speed(integer)</h3><p>Sets how long the speedometer needs to calculate the speed. Defaults to 5 sec.</p>
<h3>length(integer)</h3><p>If you already know the length of the stream, then you can set it. Defaults to 0.</p>
<h3>drain(boolean)</h3><p>In case you don&#39;t want to include a readstream after progress-stream, set to true to drain automatically. Defaults to false.</p>
<h3>transferred(integer)</h3><p>If you want to set how much data have previous been downloaded. Useful for a resumed download.</p>
<h2>Examples</h2><h3>Using the request module</h3><p>This example uses request to download a 100 MB file, and writes out the percentage every second.</p>
<p>You can also find an example in <code>test/request.js</code>.</p>
<pre><code class="language-js">var progress = require(&#39;progress-stream&#39;);
var req = require(&#39;request&#39;);
var fs = require(&#39;fs&#39;);

var str = progress({
    time: 1000
});

str.on(&#39;progress&#39;, function(progress) {
    console.log(Math.round(progress.percentage)+&#39;%&#39;);
});

req(&#39;http://cachefly.cachefly.net/100mb.test&#39;, { headers: { &#39;user-agent&#39;: &#39;test&#39; }})
    .pipe(str)
    .pipe(fs.createWriteStream(&#39;test.data&#39;));
</code></pre>
<h3>Using the http module</h3><p>In <code>test/http.js</code> it&#39;s shown how to do it with the http module.</p>
<h2>Methods</h2><h3><code>setLength(newLength)</code></h3><p>Sometimes, you don&#39;t know how big a stream is right away (e.g. multipart file uploads).  You might find out after a few chunks have already passed through the stream, seconds or even minutes later.  In this case, you can use the <code>setLength</code> method to recalculate the relevant tracked progress data.</p>
<pre><code class="language-js">var str = progress({});
someFickleStreamInstance.pipe(str).pipe(fs.createWriteStream(&#39;test.data&#39;));

someFickleStreamInstance.on(&#39;conviction&#39;, function nowIKnowMyLength (actualLength) {
  str.setLength(actualLength);
});
</code></pre></body></html>